{% from 'form_macros.html' import render_field_with_validation %}
{% extends 'dashboard/index.html' %}
{% block title %}{{ 'Edit Category' if category else 'New Category' }} - Jakedaily{% endblock %}

{% block dashboard_content %}
<form method="POST" novalidate>
  {{ form.hidden_tag() }}

  <div class="editor">
    <!-- ä¸»ç·¨è¼¯å€ -->
    <div class="main_editor">
      <h1>{{ 'Edit Category' if category else 'Add Category' }}</h1>

      {{ render_field_with_validation(form.name, "Name", placeholder="Category Name") }}
      {{ render_field_with_validation(form.slug, "Slug", placeholder="category-slug") }}
      {{ render_field_with_validation(form.description, "Description", placeholder="Category Description (Optional)", rows=5) }}
    </div>

    <!-- å´é‚Šæ“ä½œå€ -->
    <aside class="sidebar_editor">
      <div class="button_group">
        <a href="{{ url_for('dashboard.categories') }}" class="btn btn-secondary">Cancel</a>
        {{ form.submit(class="btn btn-primary") }}
      </div>
    </aside>
  </div>
</form>

<!-- åˆªé™¤åˆ†é¡è¡¨å–®ï¼ˆåƒ…ç·¨è¼¯æ¨¡å¼é¡¯ç¤ºï¼‰ -->
{% if category and not category.is_default_category %}
<div style="margin-top: 2rem; padding: 1rem; border: 1px solid #dc3545; border-radius: 5px; background-color: #f8f9fa;">
  <h6 style="color: #dc3545; margin-bottom: 1rem;">âš ï¸ å±éšªæ“ä½œ</h6>
  <p style="margin-bottom: 1rem; font-size: 0.9em; color: #666;">
    åˆªé™¤åˆ†é¡ "{{ category.name or 'Unknown' }}" å°‡ç„¡æ³•å¾©åŸã€‚
    {% if category.total_post_count > 0 %}
    <br><strong>æ­¤åˆ†é¡ä¸‹çš„ {{ category.total_post_count }} ç¯‡æ–‡ç« å°‡è‡ªå‹•ç§»è‡³ "Uncategorized" åˆ†é¡ã€‚</strong>
    {% else %}
    <br>æ­¤åˆ†é¡ä¸‹æ²’æœ‰æ–‡ç« ã€‚
    {% endif %}
  </p>
  <form method="POST" action="{{ url_for('dashboard.delete_category', id=category.id) }}" style="margin: 0;" onsubmit="return confirm('ç¢ºå®šè¦åˆªé™¤åˆ†é¡ã€Œ{{ category.name or 'Unknown' }}ã€å—ï¼Ÿ{% if category.total_post_count > 0 %}\n\næ­¤åˆ†é¡ä¸‹çš„ {{ category.total_post_count }} ç¯‡æ–‡ç« å°‡ç§»è‡³ Uncategorized åˆ†é¡ã€‚{% endif %}\n\næ­¤æ“ä½œç„¡æ³•å¾©åŸï¼');">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <button type="submit" class="btn btn-danger btn-sm">
      ğŸ—‘ï¸ åˆªé™¤åˆ†é¡
      {% if category.total_post_count > 0 %}
      ({{ category.total_post_count }} ç¯‡æ–‡ç« å°‡ç§»è‡³ Uncategorized)
      {% endif %}
    </button>
    <a href="{{ url_for('dashboard.categories') }}" class="btn btn-secondary btn-sm">å–æ¶ˆ</a>
  </form>
</div>
{% endif %}
{% endblock %}