{% extends 'dashboard/index.html' %}
{% block title %}All Posts - Jakedaily{% endblock %}

{% block dashboard_content %}
<div class="content_header">
  <h1>Posts</h1>
  <div class="actions">
    <form method="get" class="search_form">
      <input type="text" name="q" placeholder="Search posts..." value="{{ request.args.get('q', '') }}">
      <select name="status">
        <option value="">All Status</option>
        <option value="draft" {% if request.args.get('status') == 'draft' %}selected{% endif %}>Draft</option>
        <option value="published" {% if request.args.get('status') == 'published' %}selected{% endif %}>Published</option>
      </select>
      <button type="submit">Filter</button>
    </form>
    <a href="{{ url_for('dashboard.new_post') }}" class="btn btn-primary">+ Add Post</a>
  </div>
</div>

<table class="dashboard_table">
  <thead>
    <tr>
      <th>Title</th>
      <th>Category</th>
      <th>Status</th>
      <th>Date</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    {% for post in posts %}
    <tr>
      <td>
        <a href="{{ url_for('main.post', slug=post.slug or 'untitled-' + post.id|string) }}" target="_blank">{{ post.title or 'Untitled' }}</a>
      </td>
      <td>
        {% if post.category %}
          <a href="{{ url_for('main.category', slug=post.category.slug|lower) }}" target="_blank">
            {{ post.category.name }}
          </a>
        {% else %}
          <span class="muted">Uncategorized</span>
        {% endif %}
      </td>
      <td>
        {% if post.status == 'published' %}
          <span class="status published">Published</span>
        {% else %}
          <span class="status draft">Draft</span>
        {% endif %}
      </td>
      <td>
        {% if post.created_at %}
          {{ post.local_created_at().strftime('%Y-%m-%d') }}
        {% else %}
          N/A
        {% endif %}
      </td>
      <td>
        <div class="action_menu">
          <a href="{{ url_for('dashboard.edit_post', id=post.id) }}" class="action_btn">✏️ Edit</a>
          <form action="{{ url_for('dashboard.delete_post', id=post.id) }}" method="POST" style="display: inline;">
              {% if csrf_enabled %}
              <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
              {% endif %}
              <button type="submit" class="delete_btn" onclick="return confirm('確定要刪除這篇文章嗎？');">刪除</button>
          </form>
        </div>
      </td>
    </tr>
    {% else %}
    <tr>
      <td colspan="5" class="muted">No posts found.</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- 分頁 -->
{% if pagination %}
<div class="pagination">
  {% if pagination.has_prev %}
    <a href="{{ url_for('dashboard.posts', page=pagination.prev_num) }}">« Previous</a>
  {% endif %}
  
  <span class="page-info">
    Page {{ pagination.page }} of {{ pagination.pages }}
  </span>
  
  {% if pagination.has_next %}
    <a href="{{ url_for('dashboard.posts', page=pagination.next_num) }}">Next »</a>
  {% endif %}
</div>
{% endif %}
{% endblock %}